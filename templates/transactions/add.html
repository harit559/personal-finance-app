{% extends 'base.html' %}

{% block title %}Add Transaction - Harit Finance{% endblock %}

{% block content %}
<div class="max-w-xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">Add Transaction</h1>
    
    <form method="POST" class="bg-slate-800 rounded-xl border border-slate-700 p-6 space-y-6">
        <!-- Transaction Type -->
        <div>
            <label class="block text-sm text-slate-400 mb-2">Type</label>
            <div class="flex gap-4">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="type" value="expense" checked 
                           class="text-indigo-600 focus:ring-indigo-500">
                    <span class="text-red-400">ðŸ’¸ Expense</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="type" value="income"
                           class="text-indigo-600 focus:ring-indigo-500">
                    <span class="text-green-400">ðŸ’° Income</span>
                </label>
            </div>
        </div>
        
        <!-- Amount -->
        <div>
            <label for="amount" class="block text-sm text-slate-400 mb-2">Amount</label>
            <div class="relative">
                <span id="currency_symbol" class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">à¸¿</span>
                <input type="number" 
                       name="amount" 
                       id="amount"
                       step="0.01" 
                       min="0.01"
                       required
                       placeholder="0.00"
                       class="w-full bg-slate-700 border border-slate-600 rounded-lg pl-8 pr-4 py-3 text-white placeholder-slate-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
            </div>
        </div>
        
        <!-- Account -->
        <div>
            <label for="account_id" class="block text-sm text-slate-400 mb-2">Account</label>
            <select name="account_id" 
                    id="account_id" 
                    required
                    class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
                {% for account in accounts %}
                <option value="{{ account.id }}">{{ account.name }}</option>
                {% else %}
                <option value="" disabled>No accounts - create one first</option>
                {% endfor %}
            </select>
        </div>
        
        <!-- Category -->
        <div>
            <label for="category_id" class="block text-sm text-slate-400 mb-2">Category</label>
            <select name="category_id" 
                    id="category_id"
                    class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
                <option value="">No category</option>
                {% for cat in categories if cat.category_type == 'expense' %}
                <option value="{{ cat.id }}" data-type="expense">{{ cat.icon }} {{ cat.name }}</option>
                {% endfor %}
                {% for cat in categories if cat.category_type == 'income' %}
                <option value="{{ cat.id }}" data-type="income">{{ cat.icon }} {{ cat.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <!-- Date -->
        <div>
            <label for="date" class="block text-sm text-slate-400 mb-2">Date</label>
            <input type="date" 
                   name="date" 
                   id="date"
                   value="{{ today }}"
                   required
                   class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
        </div>
        
        <!-- Description -->
        <div>
            <label for="description" class="block text-sm text-slate-400 mb-2">Description (optional)</label>
            <input type="text" 
                   name="description" 
                   id="description"
                   placeholder="What was this for?"
                   class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
        </div>
        
        <!-- Location -->
        <div>
            <label for="location" class="block text-sm text-slate-400 mb-2">Location (optional)</label>
            <input type="text" 
                   name="location" 
                   id="location"
                   placeholder="Where did you spend?"
                   class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500">
        </div>
        
        <!-- Buttons -->
        <div class="flex gap-4 pt-4">
            <button type="submit" 
                    class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg font-medium transition">
                Add Transaction
            </button>
            <a href="{{ url_for('transactions.list_transactions') }}" 
               class="px-6 py-3 border border-slate-600 rounded-lg text-slate-300 hover:bg-slate-700 transition">
                Cancel
            </a>
        </div>
    </form>
</div>

<script>
// Update currency symbol when account is selected
const accountSelect = document.getElementById('account_id');
const currencySymbol = document.getElementById('currency_symbol');

// Map of currency codes to symbols
const currencySymbols = {
    'USD': '$',
    'THB': 'à¸¿',
    'EUR': 'â‚¬',
    'GBP': 'Â£',
    'JPY': 'Â¥',
    'CAD': 'C$'
};

// Store account currencies
const accountCurrencies = {
    {% for account in accounts %}
    {{ account.id }}: '{{ account.currency }}',
    {% endfor %}
};

accountSelect.addEventListener('change', function() {
    const accountId = this.value;
    const currency = accountCurrencies[accountId];
    currencySymbol.textContent = currencySymbols[currency] || currency;
});

// Set initial currency symbol
if (accountSelect.value) {
    const currency = accountCurrencies[accountSelect.value];
    currencySymbol.textContent = currencySymbols[currency] || currency;
}

// Filter categories based on transaction type
const typeRadios = document.querySelectorAll('input[name="type"]');
const categorySelect = document.getElementById('category_id');
const allCategoryOptions = Array.from(categorySelect.options);

function filterCategories() {
    const selectedType = document.querySelector('input[name="type"]:checked').value;
    
    // Remove all options except "No category"
    categorySelect.innerHTML = '<option value="">No category</option>';
    
    // Add back only matching categories
    allCategoryOptions.forEach(option => {
        if (option.value === '') return; // Skip the "No category" option
        
        const categoryType = option.getAttribute('data-type');
        if (categoryType === selectedType) {
            categorySelect.appendChild(option.cloneNode(true));
        }
    });
}

// Add event listener to type radio buttons
typeRadios.forEach(radio => {
    radio.addEventListener('change', filterCategories);
});

// Filter categories on page load (default is expense)
filterCategories();
</script>
{% endblock %}
